# TODO List - Bounce Zero

Сделать все шрифты - их вроде бы 5 штук. 9 12 16 23px.
И потом их подключить по аналогии.

---

## ОПТИМИЗАЦИЯ ПРОИЗВОДИТЕЛЬНОСТИ

### Батчинг отрисовки текста
**Приоритет: ВЫСОКИЙ** - Критическая проблема производительности

**Проблема:**
Текущая система отрисовки шрифтов создает тысячи GU команд:
- `graphics_draw_text_scaled()` рендерит каждый пиксель символа отдельным `graphics_draw_rect()` вызовом
- Для длинных UTF-8 строк (особенно русского текста) это создает > 10000 GU команд
- Превышение лимита GU command buffer приводит к крашам эмулятора

**Текущий код (src/graphics.c:graphics_draw_text_scaled):**
```c
for (int row = 0; row < 9; row++) {
    for (int col = 0; col < glyph->width; col++) {
        if (glyph->row[row] & (1 << (7 - col))) {
            graphics_draw_rect(cur_x + col * scale, y + row * scale, scale, scale, color);
        }
    }
}
```

**Решение:**
1. **Создать текстуру для шрифта** - загрузить все символы в одну текстуру
2. **Батчить символы в quad'ы** - один GU_TRIANGLES вызов на много символов
3. **Использовать vertex buffer** - подготовить все вершины сразу

**Выгода:**
- Сокращение GU команд с 10000+ до 1-2
- Возможность отображения длинных текстов без крашей
- Улучшение производительности рендеринга

---

## ОПТИМИЗАЦИЯ ДАННЫХ

### Рефакторинг поля transform в TileMeta
**Приоритет: СРЕДНИЙ** - Архитектурная проблема с runtime вычислениями

**Проблема:**
Кольца используют runtime вычисления трансформаций вместо хранения их в таблице:

```c
// Плохо: вычисления в level.c
TileTransform bg_transform = (t->orientation == ORIENT_VERT_TOP) ? TF_ROT_270_FLIP_X :
                            (t->orientation == ORIENT_VERT_BOTTOM) ? TF_ROT_270_FLIP_XY :
                            (t->orientation == ORIENT_HORIZ_LEFT) ? TF_FLIP_Y :
                            (t->orientation == ORIENT_HORIZ_RIGHT) ? TF_FLIP_XY : TF_NONE;
```

**Должно быть:**
- Записать правильные `TF_*` значения в поле `transform` для всех колец в таблице
- Убрать runtime вычисления, использовать `t->transform` напрямую
- Переименовать `orientation` → `collision_shape` для ясности

**План исправления:**
1. **[ ] Записать правильные трансформации в tile_table.c:**
   - ID 13-16 (активные кольца): правильные TF_* вместо TF_NONE
   - ID 17-20 (неактивные кольца): правильные TF_* вместо TF_NONE  
   - ID 21-28 (большие кольца): правильные TF_* вместо TF_NONE

2. **[ ] Упростить level.c рендеринг колец:**
   - Убрать вычисления bg_transform/fg_transform
   - Использовать `t->transform` напрямую
   - Убрать условную логику с orientation

3. **[ ] Переименовать поля:**
   - `orientation` → `collision_shape` (для коллизий)
   - `transform` → `sprite_transform` (для графики)
   - Для колец: `collision_shape = COLLISION_NONE`

**Выгода:**
- Убрать runtime вычисления (производительность)
- Упростить код level.c
- Четкое разделение коллизий и графики
- Подготовка к дальнейшим оптимизациям структуры


---

## Что довести до оригинала

### . Тайминг апдейта
**Приоритет: НИЗКИЙ** - Точность оригинала
Оригинал тикает таймером каждые 30 мс (~33.3 FPS). Убедиться, что наш фиксированный тик действительно 30 мс, а не 33/16/60. Если «30 FPS управляется из main.c» — синхронизировать именно на 30 мс.


