ИСТОРИЯ ПЕРЕИМЕНОВАНИЙ - BOUNCE PSP
=======================================

Дата: 2024-09-24
Цель: Улучшение читаемости кода и согласованности именования

## 1. ПЕРЕМЕННЫЕ INPUT MODULE
- `pad` → `s_current_pad`
- `old_pad` → `s_prev_pad`

Файлы: src/input.c
Причина: Слишком короткие имена переменных, добавлен префикс s_ для статических переменных

## 2. ФУНКЦИИ ЛОКАЛИЗАЦИИ
- `local_get_select_level_text()` → `local_text_select_level()`
- `local_get_settings_text()` → `local_text_settings()`

Файлы: src/local.h, src/local.c, src/menu.c
Причина: Длинные имена функций, лучше краткий вариант с группировкой local_text_*

## 3. КОНСТАНТЫ МЕНЮ
- `MENU_TITLE_Y` → `MAIN_MENU_TITLE_Y`
- `MENU_PADDING_X` → `MAIN_MENU_PADDING_X`
- `MENU_PADDING_Y` → `MAIN_MENU_PADDING_Y`
- `MENU_SELECTION_BG_HEIGHT` → `MAIN_MENU_SELECTION_BG_HEIGHT`

Файлы: src/menu.h, src/menu.c
Причина: Несогласованность префиксов (MENU_* vs LEVEL_*), унификация через MAIN_MENU_* и LEVEL_SELECT_*

## 4. ТРАНСФОРМАЦИИ PNG
- `png_xform_t` → `png_transform_t`
- `png_draw_sprite_xform()` → `png_draw_sprite_transform()`
- Все константы `PNG_XFORM_*` → `PNG_TRANSFORM_*`
- Параметр `xform` → `transform`

Файлы: src/png.h, src/png.c, src/game.c, src/level.c
Причина: Сокращение "xform" спорное и менее читаемое, полное слово "transform" стандартно в графике

## 5. ФУНКЦИИ GAME MODULE
- `game_cleanup()` → `game_shutdown()`
- `game_get_exit_animation_offset()` → `game_exit_anim_offset()`

Файлы: src/game.h, src/game.c, src/main.c, src/level.c
Причина: Несимметричность (остальные модули используют *_shutdown), слишком длинное имя функции

## 6. РЕФАКТОРИНГ MENU API
- Удалена избыточная константа `SCREEN_CENTER_X` → вычисляется как `(SCREEN_WIDTH / 2)`
- Создан enum `menu_type_t` для типов меню
- Добавлены универсальные функции:
  - `menu_update_by_type(menu_type_t type)` → заменяет 5 функций update
  - `menu_render_by_type(menu_type_t type)` → заменяет 5 функций render
  - `menu_get_type_from_game_state(int state)` → хелпер для преобразования
- Объединены обработчики состояний в game.c (было 10 case-блоков, стало 2)
- Старые функции помечены как устаревшие в заголовке

Файлы: src/menu.h, src/menu.c, src/game.c
Сокращение: с 12 функций до 4 функций в API (упрощение на 67%)

## ИТОГИ
- Улучшена согласованность именования между модулями
- Сокращены слишком длинные имена без потери ясности
- Заменены спорные сокращения на полные слова
- Добавлены префиксы для статических переменных
- Унифицированы префиксы констант по функциональности
- Значительно упрощен menu API через state-based подход
- Убрана избыточность и дублирование кода

Все изменения протестированы на отсутствие ошибок компиляции.

## 7. ПЕРЕМЕННЫЕ MAIN MODULE
- `tick_counter` → `physics_tick_counter`

Файлы: src/main.c
Причина: Переменная отвечает конкретно за замедление физики, неточное имя может вводить в заблуждение

## 8. PSP CALLBACK ФУНКЦИИ
- `exit_callback()` → `main_exit_callback()`
- `callback_thread()` → `main_callback_thread()`
- `setup_callbacks()` → `main_setup_callbacks()`

Файлы: src/main.c
Причина: Функции не следовали общему паттерну module_prefix_function, добавлен префикс main_ для консистентности

Все изменения протестированы на отсутствие ошибок компиляции.

## 9. УНИФИКАЦИЯ STATIC ПЕРЕМЕННЫХ
Дата: 2025-09-30
Цель: Единый стиль именования static переменных - префикс s_ для всех

### level.c (7 переменных):
- `g_tileset` → `s_tileset`
- `g_tiles_per_row` → `s_tiles_per_row`
- `g_hoop_fg` → `s_hoop_fg`
- `g_hoop_fg_count` → `s_hoop_fg_count`
- `g_ring_fg_defer` → `s_ring_fg_defer`
- `gRespawnX` → `s_respawn_x`
- `gRespawnY` → `s_respawn_y`

### local.c (3 переменные):
- `g_phone_lang` → `s_phone_lang`
- `g_string_cache` → `s_string_cache`
- `g_cache_initialized` → `s_cache_initialized`

### graphics.c (3 переменные):
- `list` → `s_list`
- `draw_buffer` → `s_draw_buffer`
- `disp_buffer` → `s_disp_buffer`

Причина: Несогласованность префиксов - были смешаны g_, s_ и без префикса для static переменных
Решение: Установлен стандарт - s_ для static переменных внутри файлов, g_ только для глобальных

## 10. УЛУЧШЕНИЕ ЧИТАЕМОСТИ ПЕРЕМЕННЫХ
Дата: 2025-09-30

### game.c (в функциях game_update и game_render):
- `Player* p` → `Player* player`

Файлы: src/game.c
Причина: Односимвольное имя p плохо читается в длинных функциях (200+ строк)

## 11. УЛУЧШЕНИЕ ФЛАГА АНИМАЦИИ ДВЕРИ
Дата: 2025-09-30

### game.c:
- `g_exit_opening` → `g_exit_is_opening`

Файлы: src/game.c
Причина: Название флага может быть неоднозначным (opening как существительное), добавлен is_ для ясности

## 12. РЕФАКТОРИНГ ЭКРАНА ИНСТРУКЦИЙ
Дата: 2025-09-30
Цель: Единый стиль модальных окон и устранение хардкодов

### Изменения:
- Убрана тестовая строка кириллического алфавита
- Добавлена белая модальная панель 240x128 (как в Game Over/Level Complete)
- Текст инструкций теперь внутри панели с отступами
- Индикатор страницы перемещён под панель и центрирован
- Убраны хардкоды количества страниц:
  - Добавлена константа `INSTRUCTIONS_TOTAL_PAGES = 6` в local.h
  - Все проверки используют эту константу вместо магических чисел

Файлы: src/menu.c, src/local.h
Результат: Единообразный UI всех модальных окон, легкое добавление новых страниц инструкций

## 13. ИСПРАВЛЕНИЯ ВЫРАВНИВАНИЯ UI
Дата: 2025-09-30

### menu.c (экраны Level Complete и Game Over):
- Исправлено центрирование кнопок с иконками (X - Continue, X - OK)
- Теперь иконка + текст центрируются как единый блок
- Расчёт: total_width = 12px (иконка) + 4px (отступ) + ширина текста

Файлы: src/menu.c
Причина: Кнопки были смещены влево из-за раздельного центрирования текста и иконки

Все изменения протестированы на отсутствие ошибок компиляции.