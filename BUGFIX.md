DEFERRED | level.c:613 | Вызовы graphics\_draw\_rect внутри render\_exit\_tile  
Почему: потенциально дублируют низкоуровневую отрисовку GU, зависят от graphics.c.  
Причина: завязка на прямой рендер вместо использования png\_draw\_sprite.  
Подозреваемая связь: graphics.c (batch система).  
Предложение: проверить позже после анализа остальных модулей рендера.

---

### menu.c / menu.h

STYLE | menu.c:79 | TODO в пункте INSTRUCTIONS без условной компиляции  
Почему: оставленный «заглушечный» код мешает понимать статус проекта.  
Предложение: либо закомс

---

### png.c / png.h

CRITICAL | png.c:46 | staticVramOffset = (FRAMEBUFFER\_SIZE\*2)  
Почему: самодельный менеджер VRAM без проверки пересечения с GU состоянием. Возможна перезапись кадробуфера.  
Предложение: использовать sceKernelVolatileMem или стандартные PSPSDK helpers (pspgu vram alloc sample).


TODO | save.c | Перенести функционал save в game.c
Почему: логически система сохранений связана с игровым состоянием, отдельный модуль избыточен.
Предложение: объединить save.c с game.c для упрощения архитектуры.

---

### save.c / save.h

MAJOR | save.c:9 | SAVE\_FILE\_PATH = "bounce\_save.dat"  
Почему: жёстко зашит путь, не соответствует PSP best practices (SAVEDATA utility, ms0:/).  
Предложение: использовать официальное API Savedata Utility для совместимости с прошивкой.

---

### main.c

MINOR | main.c:20 | PHYSICS\_TICK\_DIVIDER = 2  
Почему: магическое число, смысл (30 FPS) указан в комментарии, но лучше оформить константой.  
Предложение: `#define PHYSICS_TARGET_FPS 30`.



### physics.c


MAJOR | physics.c:193 | `sound_play_pop();`
Почему: нарушение разделения ответственности - физика вызывает звуковые эффекты напрямую.
Предложение: перенести звуковую логику в game.c, physics.c должен только возвращать события.

---

### types.h


CRITICAL | png.c:22,49–53,66 | Самодельный VRAM-аллокатор `staticVramOffset` отталкивается от двойного размера кадробуфера  
Почему: риск перетирать буферы дисплея/GE: нет координации со state PSP GU.
  
Предложение: заменить на статическую «арену» выделяемую до начала GU (как в pspsdk/samples/gu/sprite) и исключить пересечения с frame/z-буферами; добавить сброс арены при загрузке набора текстур.


MAJOR | png.c:243 | `sceKernelDcacheWritebackRange(tex->data, ...)` только для RAM-текстур  
Почему: CPU-запись в VRAM тоже требует writeback для консистентности (особенно при кэшируемых сегментах).
  
Предложение: делать writeback всегда после заполнения буфера текстуры; для VRAM — убедиться, что адрес попадает в некэшируемый диапазон либо вручную сбросить кэш.

MINOR | png.c:266–267 | `png_load_texture()` возвращает `png_load_texture_vram()`  
Почему: имя функции вводит в заблуждение относительно размещения.
  
Предложение: оставить `png_load_texture()` как RAM-вариант, а VRAM — отдельной функцией; либо переименовать для ясности.

MAJOR | graphics.c:270–297 | Batch копируется в GE-память через `sceGuGetMemory`, но лимит `MAX_SPRITES_PER_BATCH` жёсткий и без учёта размера доступного пула  
Почему: при больших пачках возможен silent-дроп спрайтов при нехватке памяти.
  
Предложение: динамически флашить пачку при оценке «хватает ли GE-памяти на следующий спрайт», либо ограничить размер пачки по верхней границе пула.

MINOR | graphics.c:141–156 | `graphics_bind_texture` всегда выставляет TexScale/Offset и фильтры  
Почему: часть стейта дублируется при каждой смене текстуры; можно кешировать параметры формата/фильтра.
  
Предложение: кешировать последний `format/filter/wrap` и не переустанавливать без необходимости.

MAJOR | main.c:40 | Поток колбэков «засыпает» навсегда на `sceKernelSleepThreadCB()`  
Почему: при нештатном завершении не будет корректного выхода; поток нужно будить и завершать.  
Предложение: хранить `cbid`, при выходе вызывать `sceKernelExitDeleteThread()` из самого потока; в main — отправить сигнал и дождаться завершения через `sceKernelWaitThreadEnd`.






MAJOR | save.c:1–4, 9 | Файл сохранений «bounce\_save.dat» в текущем каталоге  
Почему: не соблюдает PSP Savedata Utility (иконка, заголовки, сохранение в `ms0:/PSP/SAVEDATA/<TITLEID>`). Потенциальные проблемы с правами и переносимостью.

STYLE | graphics.h:—; level.c:— | Смешение «plain/textured» режима через проверки состояния в клиентском коде уровня  
Почему: ответственность слоя рендера размыта.  
Предложение: дать лёгкие врапперы: `gfx_fill_tile_bg(...)` (plain внутри) и `gfx_draw_tile_sprite(...)` (textured внутри) — чтобы клиент не трогал состояние GU.

---

PSP SDK / PSP GU best practices (точечно по коду)

MAJOR | graphics.c:init (около 66–111) | Настройка GU state частично повторяется при каждом `bind_texture`  
Почему: лишние state-changes.
  
Предложение: инициализировать неизменные параметры один раз (BLEND, ALPHA\_TEST, CULL, SCISSOR, CLEAR) в `graphics_init`, а в рендер-пути менять только необходимое.

